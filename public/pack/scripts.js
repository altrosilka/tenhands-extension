function displayeAnError(e,n){"use strict";alert(e+"\n"+n)}function getUrlParameterValue(e,n){"use strict";var t,o,r=e.substr(e.indexOf("#")+1),a="";for(r=r.split("&"),t=0;t<r.length;t+=1)if(o=r[t].split("="),o[0]===n)return o[1];return a}function listenerHandler(e,n){"use strict";return function t(o,r){var a,i;if(o===e&&void 0!==r.url&&"loading"===r.status&&r.url.indexOf("oauth.vk.com/blank.html")>-1){if(e=null,chrome.tabs.onUpdated.removeListener(t),a=getUrlParameterValue(r.url,"access_token"),void 0===a||void 0===a.length)return void displayeAnError("vk auth response problem","access_token length = 0 or vkAccessToken == undefined");if(i=Number(getUrlParameterValue(r.url,"expires_in")),0!==i)return void displayeAnError("vk auth response problem","vkAccessTokenExpiredFlag != 0"+a);chrome.storage.local.set({vkaccess_token:a},function(){chrome.tabs.update(o,{url:"upload.html#"+n+"&"+a,active:!0},function(){})})}}}function getClickHandler(){"use strict";return function(e){var n=e.srcUrl,t="upload.html#",o="3315996",r="docs,offline",a="https://oauth.vk.com/authorize?client_id="+o+"&scope="+r+"&redirect_uri=http%3A%2F%2Foauth.vk.com%2Fblank.html&display=page&response_type=token";chrome.storage.local.get({vkaccess_token:{}},function(e){return void 0===e.vkaccess_token.length?void chrome.tabs.create({url:a,selected:!0},function(e){chrome.tabs.onUpdated.addListener(listenerHandler(e.id,n))}):(t+=n+"&"+e.vkaccess_token,void chrome.tabs.create({url:t,selected:!0}))})}}function thereIsAnError(e,n,t){"use strict";document.getElementById("wrap").innerHTML="<p></p><br/><br/><center><h1>Wow! Some error arrived!</h1></center><br/><br/><p>"+e+"</p><br/><br/><p>"+n+"</p><p>"+t+"</p>"}function upload(e,n,t){"use strict";var o=new XMLHttpRequest;o.onload=function(){var r,a,i=new XMLHttpRequest;i.open("GET","https://api.vk.com/method/docs.getUploadServer?access_token="+t),i.onload=function(){var s=JSON.parse(i.response);return void 0!==s.error?(chrome.storage.local.remove("vkaccess_token"),document.getElementById("wrap").innerHTML="<p></p><br/><br/><center><h1>Ops. Something went wrong. Please try again.</h1></center><br/>",void setTimeout(function(){window.close()},3e3)):void 0===s.response.upload_url?void thereIsAnError("documentUploadServer response problem",s,e):(r=new FormData,a=new XMLHttpRequest,r.append("file",o.response,n),a.open("POST",s.response.upload_url,!0),a.onload=function(){var n,o=JSON.parse(a.response);return void 0===o.file?void thereIsAnError("Upload blob problem response problem",o,e):(n=new XMLHttpRequest,n.open("GET","https://api.vk.com/method/docs.save?file="+o.file+"&access_token="+t),n.onload=function(){var t=JSON.parse(n.response);return void 0===t.response[0].url?void thereIsAnError("documentSaveRequest - no file in response",t,e):(document.getElementById("wrap").innerHTML="<p></p><br/><br/><center><h1>Successfully uploaded!</h1></center><br/>",void setTimeout(function(){window.close()},3e3))},void n.send())},void a.send(r))},i.send()},o.responseType="blob",o.open("GET",e),o.send()}chrome.contextMenus.create({title:"Rehost on vk.com",type:"normal",contexts:["image"],onclick:getClickHandler()}),document.addEventListener("DOMContentLoaded",function(){"use strict";var e,n,t=window.location.hash.substring(1).split("&"),o=null;return void 0===t||void 0===t.length||2!==t.length?void thereIsAnError("Parsing image url","params || params.length != 2",o):(e=t[0].split("/"),void 0===e.length||0===e.length?void thereIsAnError("Getting image filename","filename.length <= 0",o):(o=t[0],n=e[e.length-1],n.indexOf("?")>-1&&(n=n.slice(0,n.indexOf("?"))),n.indexOf("#")>-1&&(n=n.slice(0,n.indexOf("#"))),n.indexOf("&")>-1&&(n=n.slice(0,n.indexOf("&"))),void upload(o,n,t[1])))});var App=angular.module("App",["ngSanitize","ui.bootstrap","templates"]);App.config(["$httpProvider",function(e){e.defaults.useXDomain=!0,delete e.defaults.headers.common["X-Requested-With"],e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=utf8"}]),App.constant("q",123),App.run([function(){VK.init({apiId:4631234,onlyWidgets:!0}),VK.Widgets.Comments("vk_comments",{limit:10,width:"800",attach:"photo,video,link"})}]),angular.module("App").controller("C_background",["$state","$scope","PS_lastfm",function(e,n){var t=this,o="/images/background/intro.jpg";return t.image=o,n.$on("artistInfoRecievedFromLF",function(e,n){t.image=n.image}),n.$on("$stateChangeStart",function(e,n,r,a){"artistpage"!==a.name&&"artistpage.section"!==a.name||"artistpage"===n.name||"artistpage.section"===n.name||(t.image=o)}),t}]),angular.module("App").controller("C_main",["$scope","S_mapping",function(e,n){var t=this;t.mainHero={},t.neededImages=["/images/intro/header.jpg","/images/intro/header-blurred.jpg"],t.showHero=function(e,o,r,a){t.mainHero={src:e,roleTxt:n.getHumanRole(o),role:o,name:r,"short":a}},t.hideHero=function(){t.mainHero={}};var o=!1;return $(window).on("scroll",function(){o||(o=!0,e.$apply(function(){t.hideScrollAnimation=!0}))}),t}]),angular.module("App").directive("autoHeight",[function(){return{link:function(e,n){var t=$(window).height()-90,o=600;o>t&&(t=o),n.height(t)}}}]),angular.module("App").directive("backgroundOnLoad",[function(){return{link:{pre:function(e,n,t){var o=t.backgroundOnLoad;"static"===n.css("position")&&n.addClass("relative"),n.children().addClass("up");var r=$(document.createElement("div")).addClass("backgroundOnLoadLayer").css({"background-image":"url("+o+")"}).appendTo(n),a=new Image;a.src=o,a.onload=function(){r.addClass("active")}}}}}]),angular.module("App").directive("mainHeroImage",["$timeout",function(e){return{scope:{hero:"="},link:function(){},controller:["$scope","$element",function(n,t){var o=!0;n.$watch("hero",function(n){if(t.find(".layer").removeClass("active"),!n||!n.src)return void(o=!0);o=!1;var r=600,a=new Image;a.src=n.src;var i=(new Date).getTime();a.onload=function(){var a=t.find(".layer"),s=$(document.createElement("div")).addClass("layer").addClass("hero-"+n.short).css({"background-image":"url("+this.src+")"}).html('<div class="info"><div class="overlay"><h2 class="text">'+n.name+'</h2><span class="role"><label>Роль:</label><i class="icon role-'+n.role+'"></i><p>'+n.roleTxt+"</p></span></div></div>").appendTo(t),l=(new Date).getTime();if(r>l-i)e(function(){a.remove(),o||s.addClass("active")},r-(l-i));else{if(a.remove(),o)return;s.addClass("active")}}},!0)}]}}]),angular.module("App").directive("preloadingIntro",["$timeout",function(e){return{scope:{src:"="},link:function(n,t){var o=n.src,r=1,a=0,i=function(n){var o=new Image;o.src=n,o.onload=function(){a++,a===r&&(t.addClass("loaded"),e(function(){t.find(".fullSizeIntro").remove(),t.find(".hero").each(function(n){var t=$(this);e(function(){t.addClass("fake")},100*n),e(function(){t.removeClass("fake")},100*n+120)})},3550))}};o.length&&"object"==typeof o?(r=o.length,angular.forEach(o,function(e){i(e)})):i(o)}}}]),angular.module("App").directive("videoOpener",[function(){return{link:function(e,n,t){n.on("click",function(){$.fancybox({content:'<video width="960" height="520" class="masked" controls="controls" loop="loop" autoplay="autoplay" poster="'+t.poster+'"><source type="video/webm" src="'+t.webmSrc+'" /><source type="video/mp4" src="'+t.mp4Src+'" /></video>',title:t.modalTitle||"Title",type:"html",overlayShow:!0,padding:0,openEffect:"none",closeEffect:"none",width:960,height:520,helpers:{overlay:{locked:!1}}})})}}}]),angular.module("App").directive("ybOpener",[function(){return{link:function(e,n,t){n.on("click",function(){$.fancybox({href:"https://www.youtube.com/embed/"+t.ybOpener+"?autoplay=1&vq=hd720&rel=0&modestbranding=0&showinfo=0&egm=1",title:t.modalTitle||"Title",type:"iframe",overlayShow:!0,padding:0,openEffect:"none",closeEffect:"none",width:720,height:480,helpers:{overlay:{locked:!1}}})})}}}]),angular.module("App").filter("lastfmDateToLocal",["localization",function(e){return function(n){if(n){var t=moment(n,"DD MMM YYYY HH:mm");return t.format("DD")+" "+e.months[t.month()]+" "+t.format("YYYY")}}}]),angular.module("App").service("S_mapping",[function(){var e={};return e.getHumanRole=function(e){var n={tank:"танк",offense:"штурм",defense:"защита",support:"поддержка"};return n[e]?n[e]:void 0},e}]),angular.module("App").service("S_utils",[function(){var e={};return e}]),angular.module("App").controller("C_heroes",[function(){var e=this;return e.selectedSpecObject={},e.selectSpec=function(){},e}]);